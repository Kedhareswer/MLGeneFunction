<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hand-Drawn Sketch Generator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            text-align: center;
        }

        .upload-section {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .image-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .image-box {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        canvas {
            max-width: 100%;
            height: auto;
            margin: 10px;
            border: 1px solid #ddd;
        }

        .controls {
            margin: 20px 0;
            padding: 15px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .slider-container {
            margin: 15px 0;
        }

        label {
            display: inline-block;
            width: 150px;
            text-align: right;
            margin-right: 10px;
        }

        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #45a049;
        }

        input[type="range"] {
            width: 200px;
            vertical-align: middle;
        }

        .style-options {
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Hand-Drawn Sketch Generator</h1>
        
        <div class="upload-section">
            <input type="file" id="imageInput" accept="image/*">
            <button onclick="processImage()">Generate Sketch</button>
            <button onclick="downloadSketch()">Download Sketch</button>
        </div>

        <div class="controls">
            <div class="style-options">
                <label>Sketch Style:</label>
                <select id="sketchStyle" onchange="processImage()">
                    <option value="pencil">Pencil Sketch</option>
                    <option value="charcoal">Charcoal Sketch</option>
                    <option value="detailed">Detailed Sketch</option>
                </select>
            </div>
            <div class="slider-container">
                <label for="lineStrength">Line Strength:</label>
                <input type="range" id="lineStrength" min="1" max="100" value="50" onchange="processImage()">
            </div>
            <div class="slider-container">
                <label for="detail">Detail Level:</label>
                <input type="range" id="detail" min="1" max="100" value="50" onchange="processImage()">
            </div>
            <div class="slider-container">
                <label for="shading">Shading Intensity:</label>
                <input type="range" id="shading" min="0" max="100" value="30" onchange="processImage()">
            </div>
        </div>

        <div class="image-container">
            <div class="image-box">
                <h3>Original Image</h3>
                <canvas id="originalCanvas"></canvas>
            </div>
            <div class="image-box">
                <h3>Hand-Drawn Sketch</h3>
                <canvas id="sketchCanvas"></canvas>
            </div>
        </div>
    </div>

    <script>
        let originalImage = null;

        document.getElementById('imageInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    originalImage = new Image();
                    originalImage.onload = function() {
                        drawOriginalImage();
                        processImage();
                    }
                    originalImage.src = event.target.result;
                }
                reader.readAsDataURL(file);
            }
        });

        function drawOriginalImage() {
            const canvas = document.getElementById('originalCanvas');
            const ctx = canvas.getContext('2d');
            
            // Set canvas size
            canvas.width = originalImage.width;
            canvas.height = originalImage.height;
            
            ctx.drawImage(originalImage, 0, 0);
        }

        function processImage() {
            if (!originalImage) return;

            const canvas = document.getElementById('sketchCanvas');
            const ctx = canvas.getContext('2d');

            // Set canvas size
            canvas.width = originalImage.width;
            canvas.height = originalImage.height;

            // Get parameters
            const lineStrength = document.getElementById('lineStrength').value / 100;
            const detail = document.getElementById('detail').value / 100;
            const shading = document.getElementById('shading').value / 100;
            const style = document.getElementById('sketchStyle').value;

            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Create temporary canvas for edge detection
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = canvas.width;
            tempCanvas.height = canvas.height;
            const tempCtx = tempCanvas.getContext('2d');

            // Draw original image
            tempCtx.drawImage(originalImage, 0, 0);

            // Get image data
            const imageData = tempCtx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;

            // Convert to grayscale
            for (let i = 0; i < data.length; i += 4) {
                const brightness = 0.34 * data[i] + 0.5 * data[i + 1] + 0.16 * data[i + 2];
                data[i] = data[i + 1] = data[i + 2] = brightness;
            }

            // Apply edge detection
            const edges = detectEdges(imageData, detail);

            // Draw sketch effect
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Apply different sketch styles
            switch(style) {
                case 'pencil':
                    applyPencilEffect(ctx, edges, lineStrength, shading);
                    break;
                case 'charcoal':
                    applyCharcoalEffect(ctx, edges, lineStrength, shading);
                    break;
                case 'detailed':
                    applyDetailedEffect(ctx, edges, lineStrength, shading);
                    break;
            }
        }

        function detectEdges(imageData, sensitivity) {
            const width = imageData.width;
            const height = imageData.height;
            const data = imageData.data;
            const edges = new Uint8ClampedArray(width * height);

            for (let y = 1; y < height - 1; y++) {
                for (let x = 1; x < width - 1; x++) {
                    const idx = (y * width + x) * 4;
                    
                    // Sobel operator
                    const gx = 
                        -1 * data[idx - 4 - width * 4] +
                        -2 * data[idx - 4] +
                        -1 * data[idx - 4 + width * 4] +
                        1 * data[idx + 4 - width * 4] +
                        2 * data[idx + 4] +
                        1 * data[idx + 4 + width * 4];

                    const gy = 
                        -1 * data[idx - width * 4 - 4] +
                        -2 * data[idx - width * 4] +
                        -1 * data[idx - width * 4 + 4] +
                        1 * data[idx + width * 4 - 4] +
                        2 * data[idx + width * 4] +
                        1 * data[idx + width * 4 + 4];

                    const magnitude = Math.sqrt(gx * gx + gy * gy) * sensitivity;
                    edges[y * width + x] = magnitude > 128 ? 255 : magnitude;
                }
            }

            return edges;
        }

        function applyPencilEffect(ctx, edges, lineStrength, shading) {
            const width = ctx.canvas.width;
            const height = ctx.canvas.height;

            // Draw edges with pencil-like strokes
            for (let y = 0; y < height; y++) {
                for (let x = 0; x < width; x++) {
                    const edge = edges[y * width + x];
                    if (edge > 30) {
                        const intensity = edge * lineStrength;
                        ctx.fillStyle = `rgba(0, 0, 0, ${intensity / 255})`;
                        
                        // Simulate pencil strokes
                        if (Math.random() < 0.3) {
                            const length = Math.random() * 3 + 1;
                            const angle = Math.random() * Math.PI;
                            ctx.beginPath();
                            ctx.moveTo(x, y);
                            ctx.lineTo(
                                x + Math.cos(angle) * length,
                                y + Math.sin(angle) * length
                            );
                            ctx.stroke();
                        }
                    }
                }
            }

            // Add shading
            if (shading > 0) {
                ctx.globalAlpha = shading * 0.3;
                for (let i = 0; i < 1000; i++) {
                    const x = Math.random() * width;
                    const y = Math.random() * height;
                    const size = Math.random() * 2;
                    ctx.fillStyle = `rgba(0, 0, 0, ${Math.random() * 0.1})`;
                    ctx.fillRect(x, y, size, size);
                }
                ctx.globalAlpha = 1;
            }
        }

        function applyCharcoalEffect(ctx, edges, lineStrength, shading) {
            const width = ctx.canvas.width;
            const height = ctx.canvas.height;

            // Draw darker background
            ctx.fillStyle = '#f8f8f8';
            ctx.fillRect(0, 0, width, height);

            // Draw edges with charcoal-like strokes
            for (let y = 0; y < height; y++) {
                for (let x = 0; x < width; x++) {
                    const edge = edges[y * width + x];
                    if (edge > 20) {
                        const intensity = edge * lineStrength * 1.5;
                        ctx.fillStyle = `rgba(0, 0, 0, ${intensity / 255})`;
                        
                        // Simulate charcoal strokes
                        if (Math.random() < 0.4) {
                            const length = Math.random() * 5 + 2;
                            const angle = Math.random() * Math.PI;
                            ctx.beginPath();
                            ctx.moveTo(x, y);
                            ctx.lineTo(
                                x + Math.cos(angle) * length,
                                y + Math.sin(angle) * length
                            );
                            ctx.lineWidth = Math.random() * 2 + 1;
                            ctx.stroke();
                        }
                    }
                }
            }

            // Add texture
            ctx.globalAlpha = shading * 0.5;
            for (let i = 0; i < 2000; i++) {
                const x = Math.random() * width;
                const y = Math.random() * height;
                const size = Math.random() * 3;
                ctx.fillStyle = `rgba(0, 0, 0, ${Math.random() * 0.2})`;
                ctx.fillRect(x, y, size, size);
            }
            ctx.globalAlpha = 1;
        }

        function applyDetailedEffect(ctx, edges, lineStrength, shading) {
            const width = ctx.canvas.width;
            const height = ctx.canvas.height;

            // Draw with detailed strokes
            for (let y = 0; y < height; y++) {
                for (let x = 0; x < width; x++) {
                    const edge = edges[y * width + x];
                    if (edge > 25) {
                        const intensity = edge * lineStrength;
                        
                        // Create cross-hatching effect
                        if (intensity > 150) {
                            drawHatchLine(ctx, x, y, 45, 3, intensity);
                            drawHatchLine(ctx, x, y, -45, 3, intensity);
                        } else if (intensity > 100) {
                            drawHatchLine(ctx, x, y, 45, 3, intensity);
                        } else if (intensity > 50) {
                            drawHatchLine(ctx, x, y, 0, 2, intensity);
                        }
                    }
                }
            }

            // Add fine details
            if (shading > 0) {
                ctx.globalAlpha = shading * 0.2;
                for (let i = 0; i < 3000; i++) {
                    const x = Math.random() * width;
                    const y = Math.random() * height;
                    drawHatchLine(ctx, x, y, Math.random() * 180, 1, Math.random() * 0.1);
                }
                ctx.globalAlpha = 1;
            }
        }

        function drawHatchLine(ctx, x, y, angle, length, intensity) {
            const radians = angle * Math.PI / 180;
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.lineTo(
                x + Math.cos(radians) * length,
                y + Math.sin(radians) * length
            );
            ctx.strokeStyle = `rgba(0, 0, 0, ${intensity / 255})`;
            ctx.lineWidth = 0.5;
            ctx.stroke();
        }

        function downloadSketch() {
            const canvas = document.getElementById('sketchCanvas');
            const link = document.createElement('a');
            link.download = 'hand-drawn-sketch.png';
            link.href = canvas.toDataURL();
            link.click();
        }
    </script>
</body>
</html>